<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
    <!-- Custom Font Icons CSS-->
    <link rel="stylesheet" href="css/font.css">
    <!-- Google fonts - Muli-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:300,400,700">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/favicon.ico">
    <!-- Tweaks for older IEs-->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
    <style>
        .black_overlay {
            display: none;
            position: absolute;
            top: 0%;
            left: 0%;
            width: 80%;
            height: 80%;
            background-color: black;
            z-index: 1400;
            /*-moz-opacity: 0.8;*/
            opacity: .80;
            filter: alpha(opacity=88);
        }

        .white_content {
            display: none;
            position: absolute;
            top: 2%;
            left: 15%;
            width: 55%;
            height: 60%;
            padding: 20px;
            border: 5px solid orange;
            background-color: #22252a;
            z-index: 1002;
            overflow: auto;
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid d-flex align-items-center justify-content-between">
                <div class="navbar-header">
                    <!-- Navbar Header--><a href="index.html" class="navbar-brand">
                        <div class="brand-text brand-big visible text-uppercase"><strong class="text-primary">智信</strong><strong>车贷管理系统</strong></div>
                        <div class="brand-text brand-sm"><strong class="text-primary">智</strong><strong>信</strong></div>
                    </a>
                    <!-- Sidebar Toggle Btn-->
                    <button class="sidebar-toggle"><i class="fa fa-long-arrow-left"></i></button>
                </div>
                <!-- Megamenu end     -->
                <!-- Log out               -->
                <div class="list-inline-item logout"><span class="d-none d-sm-inline" onclick="delCookie('uName')">退出 </span><i class="icon-logout"></i></div>
            </div>
        </nav>
    </header>
    <div class="d-flex align-items-stretch">
        <!-- Sidebar Navigation-->
        <nav id="sidebar">
            <!-- Sidebar Header-->
            <div class="sidebar-header d-flex align-items-center">
                <div class="avatar"><img src="img/avatar-6.jpg" alt="..." class="img-fluid rounded-circle"></div>
                <div class="title">
                    <h1 class="h5"><span id="name"></span></h1>
                    <p>管理员</p>
                </div>
            </div>
            <ul class="list-unstyled">
                <li><a href="index.html"><i data-icon="f" class="icon"></i>仪表盘 </a></li>
                <li class="active"><a href="shen.html"><i class="icon-settings"></i>审核员管理</a></li>
                <li><a href="user.html"><i class="icon icon-user-outline"></i>客户信息</a></li>
                <li><a href="userInfo.html"> <i class="icon-grid"></i>客户贷款信息 </a></li>
            </ul>
        </nav>
        <!-- Sidebar Navigation end-->
        <div class="page-content">
            <!-- Page Header-->
            <div class="page-header no-margin-bottom">
                <div class="container-fluid">
                    <h2 class="h5 no-margin-bottom">审核员管理</h2>
                </div>
            </div>
            <div>
                <br />
                <div class="container-fluid d-flex align-items-center justify-content-between"><span style="height:40px;margin-left:155px;">审核员名称：<input id="uname" type="text" class="input-search" />真实姓名：<input id="ttname" type="text" class="input-search" /><input id="Button1" type="button" value="查询" class="btn btn-info" onclick="search()" /></span><span style="margin-right:20px;width:40px;height:40px;"><input id="Button1" type="image" value="" src="img/photos/添加2.png" style="width:40px;height:40px;" onclick="document.getElementById('light').style.display='block';document.getElementById('fade').style.display='block'" /></span></div>

                <table class="table" style="text-align:center;border:double;font-size:13px;margin-top:5px;" border="1">
                    <thead>
                        <tr style="color:lightsalmon">
                            <th>编号</th>
                            <th>审核员名称</th>
                            <th>真实姓名</th>
                            <th>电话号</th>
                            <th>入职时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="tb" style="color:cadetblue">
                    </tbody>
                </table>
            </div>
            <div id="light" class="white_content">
                <div style="padding-left:25%;padding-top:2%;">
                    <div style="align-content:center">
                        <h4 style="padding-left:20%">添加审核员</h4>
                        <!-- Form Panel    -->
                        <div class="form d-flex align-items-center" style="margin-top:6%">
                            <div class="content">
                                <div class="form-group-material">
                                    <input id="register-username" type="text" name="registerUsername" class="input-material" onblur="changeName()" onchange="changeName()"><span id="suname" style="color:orangered">请正确输入用户名！（2-6位汉字字母数字）</span><span id="com" style="color:orangered">此用户名已被注册，请换一个吧！</span>
                                    <label for="register-username" class="label-material">用户名</label>
                                </div>
                                <div class="form-group-material">
                                    <input id="register-trueName" type="text" name="trueName" class="input-material" onblur="changeTname()" onchange="changeTname()"><span id="tname" style="color:orangered">请正确输入真实姓名！</span>
                                    <label for="register-trueName" class="label-material">真实姓名      </label>
                                </div>
                                <div>
                                    <select id="slevel" onclick="dropChange()">
                                    </select>
                                    <span id="level" style="color:orangered">请选择审核员等级！</span>
                                    <br />
                                    <p></p>
                                </div>
                                <div class="form-group-material">
                                    <input id="register-tel" type="text" name="tel" class="input-material" onblur="changeTel()" onchange="changeTel()"><span id="tel" style="color:orangered">请正确输入手机号！</span><span id="Ctel" style="color:orangered">此手机号已被注册</span>
                                    <label for="register-tel" class="label-material">手机号        </label>
                                </div>
                                <div class="form-group">
                                    <input id="addshen" type="button" value="添加" class="btn btn-primary" onclick="addShen()"><span style="width:8%"></span><input id="cancel" type="button" value="取消" class="btn btn-success" onclick="retShow()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="footer__block block no-margin-bottom">
                    <div class="container-fluid text-center">
                        <!-- Please do not remove the backlink to us unless you support us at https://bootstrapious.com/donate. It is part of the license conditions. Thank you for understanding :)-->
                        <p class="no-margin-bottom">Copyright &copy; 2019.Company name All rights reserved.More Templates <a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a></p>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <!-- JavaScript files-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/popper.js/umd/popper.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/jquery.cookie/jquery.cookie.js"></script>
    <script src="vendor/chart.js/Chart.min.js"></script>
    <script src="vendor/jquery-validation/jquery.validate.min.js"></script>
    <script src="js/front.js"></script>
</body>
</html>
<script>
    $(function () {
        var n = getCookie("uName");
        if (n == "") {
            alert("请您先登录！");
            location.href = "login.html";
        }
        $("#name").text(n);
        load();
        document.getElementById("name").style.display = "none";
        document.getElementById("com").style.display = "none";
        document.getElementById("tname").style.display = "none"; 
        document.getElementById("suname").style.display = "none";
        document.getElementById("tel").style.display = "none";
        document.getElementById("Ctel").style.display = "none";
        document.getElementById("level").style.display = "none";
        dropDown();
    })

    // 我们定义一个函数，用来读取特定的cookie值。［得到指定名字的cookie对象哦！］
    function getCookie(name) {
        var strCookie = document.cookie;
        var arrCookie = strCookie.split("; ");
        for (var i = 0; i < arrCookie.length; i++) {
            var arr = arrCookie[i].split("=");
            if (arr[0] == name) return arr[1];
        }
        return "";
    }

    //清除cookie
    function delCookie(name) {//为了删除指定名称的cookie，可以将其过期时间设定为一个过去的时间
        var date = new Date();
        date.setTime(date.getTime() - 10000);
        document.cookie = name + "=a; expires=" + date.toGMTString();
        location.href = "login.html";
    }

    function dropChange() {
        var lid = $("#slevel option:selected").val();
        if (lid == -1) {
            document.getElementById("level").style.display = "block";
        }
        else {
            document.getElementById("level").style.display = "none";
        }
    }

    function retShow() {
        document.getElementById('light').style.display = 'none'; document.getElementById('fade').style.display = 'none';
    }

    //绑定等级下拉
    function dropDown() {
        $.ajax({
            url: "https://localhost:44356/api/ZXLoan/GetLevel",
            type: "get",
            success: function (d) {
                $("#slevel").empty();
                $("#slevel").append('<option value="-1">--请选择--</option>')
                $(d).each(function () {
                    var line = '<option value="' + this.Sid + '">' + this.Sname + '</option>';
                    $("#slevel").append(line);
                })
            }
        })
    }

    function changeName() {
        var name = $("#register-username").val();
        //用户名正则验证+判重
        var re = /^[\u4E00-\u9FA5A-Za-z0-9]+$/;
        if (re.test(name) && name.length >= 2 && name.length <= 6) {
            $.ajax({
                url: "https://localhost:44356/api/ZXLoan/ComName?name=" + name,
                type: "post",
                success: function (d) {
                    if (d > 0) {
                        document.getElementById("com").style.display = "block";
                        document.getElementById("suname").style.display = "none";
                    }
                    else {
                        document.getElementById("suname").style.display = "none";
                    }
                }
            })
        }
        else {
            document.getElementById("suname").style.display = "block";
            document.getElementById("com").style.display = "none";
        }
    }
    function changeTname() {
        var name = $("#register-trueName").val();
        //真实姓名正则验证
        var regName = /^[\u4E00-\u9FA5]{2,4}$/;
        if (regName.test(name)) {
            document.getElementById("tname").style.display = "none";
        }
        else {
            document.getElementById("tname").style.display = "block";
        }
    }
    function changeTel() {
        var tel = $("#register-tel").val();

        document.getElementById("tel").style.display = "none";
        document.getElementById("Ctel").style.display = "none";
        //手机号正则验证
        var re = /^1\d{10}$/;
        if (re.test(tel)) {
            $.ajax({
                url: "https://localhost:44356/api/ZXLoan/Ctel?tel=" + tel,
                type: "post",
                success: function (d) {
                    if (d > 0) {
                        document.getElementById("Ctel").style.display = "block";
                    }
                    else {
                        document.getElementById("suname").style.display = "none";
                        $("#Button1").attr("disabled", false)
                    }
                }
            })
        }
        else {
            document.getElementById("tel").style.display = "block";
            $("#Button1").attr("disabled", "true")
        }
    }

    //添加审核员
    function addShen() {
        var name = $("#register-username").val();
        var tname = $("#register-trueName").val();
        var tel = $("#register-tel").val();
        var lid = $("#slevel option:selected").val();
        if (lid == -1) {
            document.getElementById("level").style.display = "block";
            return;
        }
        else {
            document.getElementById("level").style.display = "none";
        }
        changeName();
        changeTname();
        changeTel();
        if (name != "" && tname != "" && tel != "") {
            $.ajax({
                url: "https://localhost:44356/api/ZXLoan/addShen",
                type: "post",
                data: { Uname: name, Utname: tname, Utel: tel, Ulevel: lid },
                success: function (d) {
                    if (d > 0) {
                        alert("添加成功！");
                        location.href = "shen.html";
                        retShow();
                    }
                    else {
                        alert("添加失败！");
                    }
                }
            })
        }


        //window.open('addShen.html', 'newwindow', 'height=600, width=740, top=160, left=260, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=no, status=no') //这句要写成一行
        //window.open 弹出新窗口的命令；
        //'page.html' 弹出窗口的文件名；
        //'newwindow' 弹出窗口的名字（不是文件名），非必须，可用空''代替；
        //height = 100 窗口高度；
        //width = 400 窗口宽度；
        //top = 0 窗口距离屏幕上方的象素值；
        //left = 0 窗口距离屏幕左侧的象素值；
        //toolbar = no 是否显示工具栏，yes为显示；
        //menubar，scrollbars 表示菜单栏和滚动栏。
        //resizable = no 是否允许改变窗口大小，yes为允许；
        //location = no 是否显示地址栏，yes为允许；
        //status = no 是否显示状态栏内的信息（通常是文件已经打开），yes为允许；
    }

    //window.onbeforeunload = function () {
        //这里刷新方法有很多，具体要看你的子窗口是怎样出来的
        //window.opener.location.reload();
        //parent.location.reload();
        //self.opener.location.reload();
        //window.opener.location.href=window.opener.location.href;
    //};

    //显示
    function load() {
        $.ajax({
            url: "https://localhost:44356/api/ZXLoan/GetShen",
            type: "get",
            success: function (d) {
                $("#tb").empty();
                $(d).each(
                    function () {
                        var line = '<tr>'
                            + '<td>' + this.RowID + '</td>'
                            + '<td>' + this.Uname + '</td>'
                            + '<td>' + this.Utname + '</td>'
                            + '<td>' + this.Utel + '</td>'
                            + '<td>' + this.Utime + '</td>'
                            + '<td><input id="Button1" type="button" value="取消审核员身份" class="btn btn-success" onclick="cancel(' + this.Uid + ')"/></td>'
                            + '</tr>'
                        $("#tb").append(line);
                    }
                )
            }
        })
    }

    //查询
    function search() {
        var name = $("#uname").val();
        var tname = $("#ttname").val();
        $.ajax({
            url: "https://localhost:44356/api/ZXLoan/GetShenSearch",
            type: "post",
            data: {Uname:name,Utname:tname},
            success: function (d) {
                $("#tb").empty();
                $(d).each(
                    function () {
                        var line = '<tr>'
                            + '<td>' + this.RowID + '</td>'
                            + '<td>' + this.Uname + '</td>'
                            + '<td>' + this.Utname + '</td>'
                            + '<td>' + this.Utel + '</td>'
                            + '<td>' + this.Utime + '</td>'
                            + '<td><input id="Button1" type="button" value="取消审核员身份" class="btn btn-success" onclick="cancel(' + this.Uid + ')"/></td>'
                            + '</tr>'
                        $("#tb").append(line);
                    }
                )
            }
        })
    }

    //取消管理员身份
    function cancel(uid) {
        $.ajax({
            url: "https://localhost:44356/api/ZXLoan/CancelShen?Uid=" + uid,
            type: "post",
            success: function (d) {
                if (d > 0) {
                    alert("操作成功！");
                    load();
                } else {
                    alert("操作失败！");
                }
            }
        })
    }
</script>